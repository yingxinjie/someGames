{"version":3,"sources":["assets\\bundle\\01_hall\\script\\view\\login.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { ViewManager } from \"../config/ViewManager\";\r\nimport { Utils } from \"../config/Utils\";\r\nimport ComponentBase from \"../../../00_base/script/common/ComponentBase\";\r\nimport { AccountType, EventName, HttpPath, ViewEnum, WidgetEnum } from \"../config/config\";\r\nimport { CodeStruct, CountryCodeData } from \"../../../00_base/script/common/CountryCode\";\r\nimport { C_User } from \"../config/C_User\";\r\nimport { Tips } from \"../../../00_base/script/uiutils/tips\";\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class login extends ComponentBase {\r\n\r\n    @property(cc.Node)\r\n    selectBtn: cc.Node = null;\r\n    @property(cc.Label)\r\n    countryCode: cc.Label = null;\r\n\r\n    @property(cc.Node)\r\n    resetBtn: cc.Node = null\r\n    @property(cc.Node)\r\n    regBtn: cc.Node = null\r\n\r\n    @property(cc.Node)\r\n    phoneLoginBtn: cc.Node = null\r\n    @property(cc.Node)\r\n    mailLoginBtn: cc.Node = null\r\n\r\n    start() {\r\n        this.TouchOn(this.selectBtn, this.openCountryCode);\r\n        this.TouchOn(this.resetBtn, this.openResetPanel);\r\n        this.TouchOn(this.regBtn, this.openRegPanel);\r\n        this.TouchOn(this.phoneLoginBtn, this.phoneLogin);\r\n        this.TouchOn(this.mailLoginBtn, this.mailLogin);\r\n\r\n        this.EventOn(EventName.SelectCountryCode, this.onSelectCountryCode);\r\n    }\r\n\r\n    private openCountryCode() {\r\n        ViewManager.Alert(WidgetEnum.CountryCode);\r\n    }\r\n\r\n    private onSelectCountryCode(idx: string) {\r\n        let codeObj: CodeStruct = CountryCodeData[idx];\r\n        this.countryCode.string = codeObj.code;\r\n    }\r\n\r\n    /** 重置密码 */\r\n    private openResetPanel() {\r\n        ViewManager.Open(ViewEnum.Reset);\r\n    }\r\n\r\n    /** 注册新账号 */\r\n    private openRegPanel() {\r\n        ViewManager.Open(ViewEnum.Reg);\r\n    }\r\n\r\n\r\n    @property(cc.Label)\r\n    private phoneAreaCode: cc.Label = null;\r\n    @property(cc.EditBox)\r\n    private phoneEdit: cc.EditBox = null;\r\n    @property(cc.EditBox)\r\n    private phonePwd: cc.EditBox = null;\r\n\r\n    /** 点击了手机登录的按钮 */\r\n    private async phoneLogin() {\r\n        let phone: string = this.phoneEdit.string;\r\n        let pwd: string = this.phonePwd.string;\r\n        let code: string = this.phoneAreaCode.string;\r\n        if (!Utils.IsPhone(phone)) {\r\n            Tips.Show(\"请输入正确的手机号!\");\r\n            return;\r\n        }\r\n        if (pwd.length < 6) {\r\n            Tips.Show(\"密码长度不够,至少6位字符!\");\r\n            return;\r\n        }\r\n        if (!this.phoneAreaCode || code == \"\") {\r\n            Tips.Show(\"请选择区位码!\");\r\n            return;\r\n        }\r\n\r\n        let data = {\r\n            phoneAreaCode: this.phoneAreaCode.string,\r\n            phoneNumber: phone,\r\n            loginPwd: pwd,\r\n            device: Utils.CheckDeviceType(),\r\n            deviceInfo: \"\",\r\n            longitude: \"\",\r\n            latitude: \"\",\r\n            ip: \"\",\r\n        }\r\n        console.log(\"请求数据\", JSON.stringify(data))\r\n        let res: any = await Utils.Post(HttpPath.phoneLogin, data);\r\n        console.log(\"登录数据返回\", JSON.stringify(res))\r\n        if (res.code != 200) {\r\n            cc.error(\"手机登陆请求错误\", HttpPath.phoneLogin, JSON.stringify(res));\r\n            return;\r\n        }\r\n\r\n        C_User.ins.me.uid = res.uuid;\r\n        C_User.ins.me.name = res.data.name;\r\n        C_User.ins.me.headPic = res.data.headPic;\r\n        C_User.ins.me.sex = res.data.sex;\r\n        C_User.ins.me.vipValidityPeriod = res.data.vipValidityPeriod;\r\n        C_User.ins.me.vipType = res.data.vipType;\r\n        C_User.ins.uid = res.uuid;\r\n        C_User.ins.token = res.data.token;\r\n\r\n        await ViewManager.Alert(WidgetEnum.BottomToggle);\r\n        await ViewManager.Open(ViewEnum.FaXian);\r\n    }\r\n\r\n    @property(cc.EditBox)\r\n    private mailEdit: cc.EditBox = null;\r\n    @property(cc.EditBox)\r\n    private mailPwd: cc.EditBox = null;\r\n\r\n    private async mailLogin() {\r\n        let mail: string = this.mailEdit.string;\r\n        let pwd: string = this.mailPwd.string;\r\n        if (!Utils.IsMail(mail)) {\r\n            Tips.Show(\"请输入正确的邮箱!\");\r\n            return;\r\n        }\r\n        if (pwd.length < 6) {\r\n            Tips.Show(\"密码长度不够,至少6位字符!\");\r\n            return;\r\n        }\r\n\r\n        let data = {\r\n            email: mail,\r\n            loginPwd: pwd,\r\n            ip: \"\",\r\n            longitude: \"\",\r\n            latitude: \"\",\r\n            device: Utils.CheckDeviceType(),\r\n            deviceInfo: \"\",\r\n            userAgent: navigator.userAgent.toLowerCase(),\r\n        }\r\n\r\n        console.log(\"请求数据\", JSON.stringify(data))\r\n        let res: any = await Utils.Post(HttpPath.emailLogin, data);\r\n        console.log(\"登录数据返回\", JSON.stringify(res))\r\n        if (res.code != 200) {\r\n            cc.error(\"手机登陆请求错误\", HttpPath.emailLogin, JSON.stringify(res));\r\n            return;\r\n        }\r\n\r\n        C_User.ins.uid = res.uuid;\r\n        C_User.ins.me.name = res.data.name;\r\n        C_User.ins.me.headPic = res.data.headPic;\r\n        C_User.ins.me.sex = res.data.sex;\r\n        C_User.ins.me.vipValidityPeriod = res.data.vipValidityPeriod;\r\n        C_User.ins.me.vipType = res.data.vipType;\r\n        C_User.ins.me.uid = res.uuid;\r\n        C_User.ins.token = res.data.token;\r\n\r\n        await ViewManager.Alert(WidgetEnum.BottomToggle);\r\n        await ViewManager.Open(ViewEnum.FaXian);\r\n    }\r\n\r\n}"]}