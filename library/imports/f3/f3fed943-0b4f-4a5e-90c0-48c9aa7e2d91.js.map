{"version":3,"sources":["assets\\bundle\\01_hall\\script\\view\\reg.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { ViewManager } from \"../config/ViewManager\";\r\nimport { CodeStruct, CountryCodeData } from \"../../../00_base/script/common/CountryCode\";\r\nimport { AccountType, EventName, HttpPath, UserSex, ViewEnum, WidgetEnum } from \"../config/config\";\r\nimport ComponentBase from \"../../../00_base/script/common/ComponentBase\";\r\nimport { Utils } from \"../config/Utils\";\r\nimport TimeTickerDown from \"../../../00_base/script/common/TimeTickerDown\";\r\nimport { Tips } from \"../../../00_base/script/uiutils/tips\";\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class reg extends ComponentBase {\r\n    @property(cc.Node)\r\n    backBtn: cc.Node = null;\r\n    @property(cc.Node)\r\n    selectCountryCodeBtn: cc.Node = null;\r\n\r\n\r\n    start() {\r\n        this.TouchOn(this.backBtn, this.backLogin);\r\n\r\n        this.TouchOn(this.selectCountryCodeBtn, this.openCountryCode);\r\n        this.TouchOn(this.sendPhoneCodeBtn, this.onSendPhoneCode);\r\n        this.TouchOn(this.phoneNextBtn, this.nextPhoneAccount);\r\n\r\n        this.TouchOn(this.sendMailCodeBtn, this.onSendMailCode);\r\n        this.TouchOn(this.mailNextBtn, this.nextMailAccount)\r\n        this.EventOn(EventName.SelectCountryCode, this.onSelectCountryCode);\r\n    }\r\n\r\n    private backLogin() {\r\n        ViewManager.Open(ViewEnum.Login);\r\n    }\r\n\r\n    private openCountryCode() {\r\n        ViewManager.Alert(WidgetEnum.CountryCode);\r\n    }\r\n\r\n\r\n\r\n    @property(cc.Label)\r\n    private countryCode: cc.Label = null\r\n    @property(cc.Node)\r\n    private sendPhoneCodeBtn: cc.Node = null;\r\n    @property(cc.EditBox)\r\n    private phoneEdit: cc.EditBox = null\r\n    @property(cc.EditBox)\r\n    private phoneCodeEdit: cc.EditBox = null\r\n    @property(cc.EditBox)\r\n    private phonePwdEdit: cc.EditBox = null;\r\n    @property(cc.Node)\r\n    private phoneNextBtn: cc.Node = null;\r\n\r\n\r\n    private onSelectCountryCode(idx: string) {\r\n        let codeObj: CodeStruct = CountryCodeData[idx];\r\n        this.countryCode.string = codeObj.code;\r\n    }\r\n\r\n    /** 手机验证码 */\r\n    private async onSendPhoneCode() {\r\n        let ttd = this.sendPhoneCodeBtn.getComponent(TimeTickerDown) as TimeTickerDown;\r\n        if (ttd.down) {\r\n            return;\r\n        }\r\n\r\n        let phone = this.phoneEdit.string;\r\n        let areaCode = this.countryCode.string;\r\n        if (!Utils.IsPhone(phone)) {\r\n            Tips.Show(\"手机号错误!\");\r\n            return;\r\n        }\r\n\r\n        if (areaCode == \"\") {\r\n            Tips.Show(\"国际码不能为空!\")\r\n            return;\r\n        }\r\n\r\n        let res: { code: number, msg: string } = await Utils.Post(HttpPath.phoneCaptcha, { phoneAreaCode: areaCode, phoneNumber: phone }) as unknown as { code: number, msg: string };\r\n        console.log(\"请求手机验证码\", JSON.stringify(res));\r\n        if (res.code != 200) {\r\n            cc.error(`请求验证码失败,稍后再试!`)\r\n            return;\r\n        }\r\n\r\n        Tips.Show(\"验证码已发送!\")\r\n        ttd.run();\r\n    };\r\n\r\n\r\n    /** 手机注册 */\r\n    private async nextPhoneAccount() {\r\n        let phone: string = this.phoneEdit.string;\r\n        let pwd: string = this.phonePwdEdit.string;\r\n        let yzm: string = this.phoneCodeEdit.string;\r\n        let areaCode: string = this.countryCode.string;\r\n        if (!Utils.IsPhone(phone)) {\r\n            Tips.Show(\"手机号不对!\")\r\n            return;\r\n        }\r\n        if (yzm.length < 6) {\r\n            Tips.Show(\"验证码填写错误\")\r\n            return;\r\n        }\r\n        if (pwd.length < 6) {\r\n            Tips.Show(\"密码不能小于6位!\");\r\n            return;\r\n        }\r\n        if (areaCode == \"\") {\r\n            Tips.Show(\"国际码不能为空!\")\r\n            return;\r\n        }\r\n\r\n        let info = {\r\n            \"phoneAreaCode\": areaCode,//区号\r\n            \"phoneNumber\": phone,//手机号\r\n            \"loginPwd\": pwd,//密码\r\n            \"captcha\": yzm,//验证码\r\n            \"sex\": UserSex.BOY,//性别\r\n            \"longitude\": \"\",//\r\n            \"latitude\": \"\",\r\n            \"ip\": \"\",\r\n            \"device\": Utils.CheckDeviceType(),\r\n            \"deviceInfo\": \"\",\r\n            \"userAgent\": navigator.userAgent.toLowerCase(),\r\n        }\r\n\r\n        console.log(\"手机注册信息\", JSON.stringify(info));\r\n        let res: { code: number, msg: string } = await Utils.Post(HttpPath.phoneReg, info) as unknown as { code: number, msg: string };\r\n        console.log(\"手机注册返回信息\", JSON.stringify(res));\r\n        if (res.code != 200) {\r\n            cc.error(`注册失败,code:${res.code}`);\r\n            Tips.Show(\"注册失败,稍后再试!\");\r\n            return;\r\n        }\r\n\r\n        Tips.Show(\"注册成功!\");\r\n        ViewManager.Open(ViewEnum.Login);\r\n    }\r\n\r\n\r\n    //============================\r\n    @property(cc.Node)\r\n    sendMailCodeBtn: cc.Node = null;\r\n    @property(cc.EditBox)\r\n    private mailEdit: cc.EditBox = null\r\n    @property(cc.EditBox)\r\n    private mailCodeEdit: cc.EditBox = null\r\n    @property(cc.EditBox)\r\n    private mailPwdEdit: cc.EditBox = null;\r\n    @property(cc.Node)\r\n    private mailNextBtn: cc.Node = null;\r\n\r\n    /** 邮箱验证码 */\r\n    private async onSendMailCode() {\r\n        let ttd = this.sendMailCodeBtn.getComponent(TimeTickerDown) as TimeTickerDown;\r\n        if (ttd.down) {\r\n            return;\r\n        }\r\n\r\n        let mail = this.mailEdit.string;\r\n        if (!Utils.IsMail(mail)) {\r\n            Tips.Show(\"邮箱格式错误!\");\r\n            return;\r\n        }\r\n\r\n        let res: { code: number, msg: string } = await Utils.Post(HttpPath.emailCaptcha, { email: mail }) as unknown as { code: number, msg: string };\r\n        console.log(\"请求邮箱验证码\", JSON.stringify(res));\r\n        if (res.code != 200) {\r\n            cc.error(`请求验证码失败,稍后再试!`);\r\n            Tips.Show(\"验证码获取失败,稍后再试!\");\r\n            return;\r\n        }\r\n\r\n\r\n        Tips.Show(\"验证码已发送,请到邮箱查收!\");\r\n        ttd.run();\r\n    }\r\n\r\n    /** 邮箱注册 */\r\n    private async nextMailAccount() {\r\n        let mail: string = this.mailEdit.string;\r\n        let pwd: string = this.mailPwdEdit.string;\r\n        let yzm: string = this.mailCodeEdit.string;\r\n        if (!Utils.IsMail(mail)) {\r\n            Tips.Show(\"邮箱格式不对!\")\r\n            return;\r\n        }\r\n        if (yzm.length < 6) {\r\n            Tips.Show(\"验证码长度错误\")\r\n            return;\r\n        }\r\n        if (pwd.length < 6) {\r\n            Tips.Show(\"密码不能小于6位!\");\r\n            return;\r\n        }\r\n\r\n        let info = {\r\n            \"email\": mail,\r\n            \"loginPwd\": pwd,\r\n            \"captcha\": yzm,\r\n            \"sex\": UserSex.BOY,\r\n            \"ip\": \"\",\r\n            \"longitude\": \"\",\r\n            \"latitude\": \"\",\r\n            \"device\": Utils.CheckDeviceType(),\r\n            \"deviceInfo\": \"\",\r\n            \"userAgent\": navigator.userAgent.toLowerCase(),\r\n        }\r\n        console.log(\"邮箱注册信息\", JSON.stringify(info));\r\n        let res: { code: number, msg: string } = await Utils.Post(HttpPath.emailReg, info) as unknown as { code: number, msg: string };\r\n        console.log(\"邮箱注册信息返回\", JSON.stringify(res));\r\n        if (res.code != 200) {\r\n            cc.error(`注册失败,code:${res.code}`);\r\n            return;\r\n        }\r\n\r\n        Tips.Show(\"注册成功!\");\r\n        ViewManager.Open(ViewEnum.Login);\r\n    }\r\n\r\n\r\n}\r\n"]}